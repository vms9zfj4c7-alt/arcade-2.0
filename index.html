<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ultimate Arcade Hub</title>
    <style>
        /* --- VARIABLES GLOBALES --- */
        :root {
            --bg-color: #1a1a2e;
            --panel-bg: #16213e;
            --text-color: #ecf0f1;
            --accent-main: #00fff2;
            --accent-secondary: #ff00de;
            transition: all 0.5s ease;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* --- INPUT FICHIER CACH√â --- */
        #rom-uploader { display: none; }

        /* --- BOUTON RETOUR --- */
        #backBtn {
            position: fixed; top: 20px; left: 20px;
            background: rgba(0,0,0,0.5); border: 2px solid var(--text-color);
            color: var(--text-color); padding: 10px 20px; border-radius: 30px;
            cursor: pointer; z-index: 100; font-weight: bold; display: none;
            backdrop-filter: blur(5px);
        }
        #backBtn:hover { background: var(--text-color); color: var(--bg-color); }

        /* --- HUB --- */
        #hubSection {
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            min-height: 100vh; width: 100%; text-align: center; animation: fadeIn 1s ease;
            padding: 50px 0; box-sizing: border-box;
        }

        .hub-title {
            font-size: 4rem; text-transform: uppercase;
            background: linear-gradient(to right, #00fff2, #ff00de);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            margin-bottom: 50px; text-shadow: 0 0 20px rgba(0, 255, 242, 0.3);
            letter-spacing: 5px; margin-top: 0; 
        }

        .category-container { display: flex; gap: 30px; flex-wrap: wrap; justify-content: center; }

        .cat-card {
            width: 250px; height: 350px; border-radius: 20px; position: relative; cursor: pointer; overflow: hidden;
            border: 3px solid rgba(255,255,255,0.1); transition: transform 0.3s, box-shadow 0.3s;
        }
        .cat-card:hover { transform: scale(1.05); z-index: 10; }
        .cat-content { position: absolute; bottom: 0; width: 100%; padding: 20px; background: linear-gradient(to top, rgba(0,0,0,0.9), transparent); box-sizing: border-box; }
        .cat-card h3 { margin: 0; font-size: 2rem; text-transform: uppercase; }
        
        .cat-horror { background: url('https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQ1hQ1Tg2OCzRWQZoMLX1sntQeezskh32s_Hg&s') center/cover; border-color: #f1c40f; }
        .cat-horror:hover { box-shadow: 0 0 30px #f1c40f; }
        .cat-horror h3 { color: #f1c40f; }

        .cat-retro { background: url('https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTEqzZoTYqECscX9XGvn_BSgwip4Hs18v34SQ&s') center/cover; border-color: #ff00de; }
        .cat-retro:hover { box-shadow: 0 0 30px #ff00de; }
        .cat-retro h3 { color: #ff00de; }

        /* --- SECTIONS JEUX --- */
        .game-section { display: none; width: 100%; flex-direction: column; align-items: center; padding-top: 40px; padding-bottom: 50px; animation: slideUp 0.5s ease; }
        @keyframes slideUp { from { opacity: 0; transform: translateY(50px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        .section-header { text-align: center; width: 100%; margin-bottom: 40px; display: flex; flex-direction: column; align-items: center; }
        .section-header h1 { font-size: 3rem; letter-spacing: 4px; color: var(--accent-main); text-transform: uppercase; margin: 0; text-shadow: 0 0 15px rgba(255, 255, 255, 0.2); text-align: center; }
        .section-header h2 { font-size: 1.2rem; color: #7f8c8d; font-weight: normal; margin-top: 10px; letter-spacing: 2px; text-align: center; }

        .theme-horror { --bg-color: #0a0a12; --panel-bg: #16213e; --text-color: #ecf0f1; --accent-main: #f1c40f; --accent-secondary: #e74c3c; }
        .theme-retro { --bg-color: #120429; --panel-bg: #260a4f; --text-color: #ffffff; --accent-main: #00fff2; --accent-secondary: #d600ff; }

        .main-container { display: flex; flex-direction: row; justify-content: center; align-items: flex-start; gap: 40px; width: 90%; max-width: 1200px; padding: 20px; box-sizing: border-box; }
        .menu-column { flex: 1; display: flex; flex-direction: column; gap: 15px; max-width: 400px; }

        .game-btn {
            background: linear-gradient(45deg, rgba(255,255,255,0.05), rgba(255,255,255,0.1));
            border: 2px solid rgba(255,255,255,0.1); color: var(--text-color); padding: 15px 20px; border-radius: 10px;
            font-size: 18px; font-weight: bold; cursor: pointer; text-align: left; transition: all 0.3s ease;
            text-decoration: none; display: flex; align-items: center; justify-content: space-between; position: relative; overflow: hidden;
        }
        .game-btn:hover { transform: translateX(10px); border-color: var(--accent-main); box-shadow: 0 0 15px var(--accent-main); background: linear-gradient(45deg, var(--panel-bg), rgba(0,0,0,0.5)); }
        .game-btn::after { content: '‚ñ∂'; opacity: 0; transition: opacity 0.3s; color: var(--accent-main); }
        .game-btn:hover::after { opacity: 1; }

        .preview-column { flex: 1.2; background-color: #000; border: 4px solid #34495e; border-radius: 20px; height: 500px; position: sticky; top: 20px; box-shadow: 0 0 30px rgba(0,0,0,0.8); overflow: hidden; display: flex; flex-direction: column; }
        .preview-image { width: 100%; height: 65%; object-fit: cover; border-bottom: 2px solid var(--accent-main); background-color: #111; display: none; }
        .preview-content { padding: 20px; background-color: var(--panel-bg); flex-grow: 1; color: #bdc3c7; display: flex; flex-direction: column; justify-content: center; align-items: center; text-align: center; border-top: 1px solid #000; position: relative; z-index: 6; }
        .preview-title { color: var(--accent-main); font-size: 3rem; margin: 0 0 10px 0; text-transform: uppercase; font-weight: bold; line-height: 1; }
        .preview-title.long-text { font-size: 1.8rem; line-height: 1.2; }
        .preview-desc { font-size: 0.95rem; line-height: 1.5; margin: 0; max-width: 100%; color: #aab7b8; }

        .tv-static { position: absolute; top: 0; left: 0; width: 100%; height: 65%; z-index: 5; background-color: #111; background-image: repeating-radial-gradient(#000 0 0.0001%, #666 0 0.0002%), repeating-conic-gradient(#000 0 0.0001%, #666 0 0.0002%); background-size: 200% 200%; animation: staticNoise 0.2s infinite; opacity: 0.6; display: block; border-bottom: 2px solid var(--accent-secondary); }
        @keyframes staticNoise { 0% { background-position: 0% 0%; } 100% { background-position: 100% 100%; } }
        .crt-overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.25) 50%), linear-gradient(90deg, rgba(255, 0, 0, 0.06), rgba(0, 255, 0, 0.02), rgba(0, 0, 255, 0.06)); background-size: 100% 2px, 3px 100%; pointer-events: none; z-index: 10; }
        .blink-text { animation: blink 1s infinite; color: var(--accent-secondary) !important; }
        @keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0.3; } }

        /* --- √âMULATEUR FULLSCREEN --- */
        #emulator-screen {
            display: none; position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: #000; z-index: 9999; flex-direction: column; align-items: center; justify-content: center;
        }
        #game { width: 100%; height: 100%; }
        #close-emu-btn {
            position: absolute; top: 10px; right: 10px; background: #e74c3c; color: white; border: 2px solid white; padding: 10px 15px; cursor: pointer; z-index: 10000; font-weight: bold; border-radius: 5px; opacity: 0.7;
        }
        #close-emu-btn:hover { opacity: 1; }

        @media (max-width: 850px) {
            .main-container { flex-direction: column-reverse; align-items: center; }
            .menu-column, .preview-column { width: 100%; }
            .preview-column { height: 350px; }
            .hub-title { font-size: 2.5rem; margin-top: 30px; }
            .section-header h1 { font-size: 2rem; }
        }
    </style>
</head>
<body>

    <input type="file" id="rom-uploader" accept=".nes,.sfc,.smc,.gba,.gb,.n64,.z64,.md,.nds" />

    <button id="backBtn" onclick="goBackToHub()">üè† ACCUEIL</button>

    <div id="emulator-screen">
        <button id="close-emu-btn" onclick="closeEmulator()">‚ùå QUITTER JEU</button>
        <div id="game"></div>
    </div>

    <div id="hubSection">
        <h1 class="hub-title">ARCADE ZONE</h1>
        <div class="category-container">
            <div class="cat-card cat-horror" onclick="openCategory('horror')">
                <div class="cat-content">
                    <h3>HORREUR</h3>
                    <p>FNAF Archives</p>
                </div>
            </div>
            <div class="cat-card cat-retro" onclick="openCategory('retro')">
                <div class="cat-content">
                    <h3>ARCADE / RETRO</h3>
                    <p>Classiques 8-Bits</p>
                </div>
            </div>
        </div>
    </div>

    <div id="horrorSection" class="game-section">
        <header class="section-header">
            <h1>HORROR ARCHIVE</h1>
            <h2>S√©lectionnez un moniteur de surveillance</h2>
        </header>
        <div class="main-container">
            <div class="menu-column">
                <div class="game-btn" onclick="launchGame('fnafnes')" onmouseenter="showPreview('fnafnes', 'horror')" onmouseleave="resetPreview('horror')"><span>FNAF (NES)</span></div>
                <div class="game-btn" onclick="launchGame('fnaf1')" onmouseenter="showPreview('fnaf1', 'horror')" onmouseleave="resetPreview('horror')"><span>F.N.A.F 1</span></div>
                <div class="game-btn" onclick="launchGame('fnaf2')" onmouseenter="showPreview('fnaf2', 'horror')" onmouseleave="resetPreview('horror')"><span>F.N.A.F 2</span></div>
                <div class="game-btn" onclick="launchGame('fnaf3')" onmouseenter="showPreview('fnaf3', 'horror')" onmouseleave="resetPreview('horror')"><span>F.N.A.F 3</span></div>
                <div class="game-btn" onclick="launchGame('fnaf4')" onmouseenter="showPreview('fnaf4', 'horror')" onmouseleave="resetPreview('horror')"><span>F.N.A.F 4</span></div>
                <div class="game-btn" onclick="launchGame('world')" onmouseenter="showPreview('world', 'horror')" onmouseleave="resetPreview('horror')"><span>F.N.A.F WORLD</span></div>
                <div class="game-btn" onclick="launchGame('sl')" onmouseenter="showPreview('sl', 'horror')" onmouseleave="resetPreview('horror')"><span>SISTER LOCATION</span></div>
                <div class="game-btn" onclick="launchGame('ps')" onmouseenter="showPreview('ps', 'horror')" onmouseleave="resetPreview('horror')"><span>PIZZERIA SIMULATOR</span></div>
                <div class="game-btn" onclick="launchGame('ucn')" onmouseenter="showPreview('ucn', 'horror')" onmouseleave="resetPreview('horror')"><span>ULTIMATE CUSTOM NIGHT</span></div>
            </div>
            <div class="preview-column">
                <div class="crt-overlay"></div>
                <div id="tvStaticHorror" class="tv-static"></div>
                <img id="previewImgHorror" class="preview-image" src="" alt="Game Preview">
                <div class="preview-content">
                    <h3 id="previewTitleHorror" class="preview-title blink-text">NO SIGNAL</h3>
                    <p id="previewDescHorror" class="preview-desc">... Connexion perdue ...<br>En attente d'entr√©e manuelle.</p>
                </div>
            </div>
        </div>
    </div>

    <div id="retroSection" class="game-section">
        <header class="section-header">
            <h1>NEON ARCADE</h1>
            <h2>Ins√©rez une pi√®ce pour jouer</h2>
        </header>
        <div class="main-container">
            <div class="menu-column">
                
                <div class="game-btn" onclick="launchGame('nsmb')" onmouseenter="showPreview('nsmb', 'retro')" onmouseleave="resetPreview('retro')"><span>NEW SUPER MARIO BROS (DS)</span></div>

                <div class="game-btn" onclick="launchGame('mario64')" onmouseenter="showPreview('mario64', 'retro')" onmouseleave="resetPreview('retro')"><span>SUPER MARIO 64</span></div>
                
                <div class="game-btn" onclick="launchGame('mario')" onmouseenter="showPreview('mario', 'retro')" onmouseleave="resetPreview('retro')"><span>SUPER MARIO BROS</span></div>
                
                <div class="game-btn" onclick="launchGame('tetris')" onmouseenter="showPreview('tetris', 'retro')" onmouseleave="resetPreview('retro')"><span>TETRIS (GB)</span></div>
                <div class="game-btn" onclick="launchGame('dk')" onmouseenter="showPreview('dk', 'retro')" onmouseleave="resetPreview('retro')"><span>DONKEY KONG (GB)</span></div>
                <div class="game-btn" onclick="launchGame('kirby')" onmouseenter="showPreview('kirby', 'retro')" onmouseleave="resetPreview('retro')"><span>KIRBY'S DREAM LAND</span></div>
                <div class="game-btn" onclick="launchGame('flappy')" onmouseenter="showPreview('flappy', 'retro')" onmouseleave="resetPreview('retro')"><span>FLAPPY BIRD (GB)</span></div>
            </div>

            <div class="preview-column" style="border-color: #00fff2;">
                <div class="crt-overlay"></div>
                <div id="tvStaticRetro" class="tv-static" style="background: repeating-linear-gradient(0deg, transparent, transparent 1px, #260a4f 1px, #260a4f 2px); opacity: 0.3;"></div>
                <img id="previewImgRetro" class="preview-image" src="" alt="Game Preview" style="border-color: #00fff2;">
                <div class="preview-content" style="background-color: #260a4f;">
                    <h3 id="previewTitleRetro" class="preview-title blink-text" style="color: #00fff2;">INSERT COIN</h3>
                    <p id="previewDescRetro" class="preview-desc">S√©lectionnez une borne d'arcade.</p>
                </div>
            </div>
        </div>
    </div>

   <script>
        // --- DONN√âES JEUX ---
        // romPath doit √™tre EXACTEMENT le nom du fichier sur GitHub/Dossier
        const gamesData = {
            // FNAF
            'fnafnes': { title: "FNAF (NES DEMAKE)", desc: "Le cauchemar en 8-bits. (Fichier .nes)", img: "https://m.gjcdn.net/game-screenshot/200/35829090-qzkrk8hm-v4.webp", romPath: "fnaf.nes", core: "nes" },
            'fnaf1': { title: "Five Nights at Freddy's 1", desc: "Survivez 5 nuits.", img: "https://sm.ign.com/ign_fr/cover/f/five-night/five-nights-at-freddys_mnb3.jpg", url: "https://irv77.github.io/hd_fnaf/1/" },
            'fnaf2': { title: "Five Nights at Freddy's 2", desc: "Pas de portes, juste un masque.", img: "https://m.media-amazon.com/images/I/81R3njc3FFL.jpg", url: "https://irv77.github.io/hd_fnaf/2/" },
            'fnaf3': { title: "Five Nights at Freddy's 3", desc: "30 ans plus tard.", img: "https://upload.wikimedia.org/wikipedia/en/2/2b/FNAF3Artwork.png", url: "https://irv77.github.io/hd_fnaf/3/" },
            'fnaf4': { title: "Five Nights at Freddy's 4", desc: "La terreur chez vous.", img: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQKh24MsbvLCcc6hqtZiWZXP6ISCibPHLmR1A&s", url: "https://irv77.github.io/hd_fnaf/4/" },
            'world': { title: "FNAF World", desc: "Aventure RPG.", img: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQnk1scIl6Kn3b_sB6r3lItNCOABwlb--PQHw&s", url: "https://irv77.github.io/hd_fnaf/w/" },
            'sl': { title: "Sister Location", desc: "Sous terre.", img: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQQjQUV7ZiKtyLjytmJgVaQuUWIPd22J13g8g&s", url: "https://irv77.github.io/hd_fnaf/sl/" },
            'ps': { title: "Pizzeria Simulator", desc: "Gestion et terreur.", img: "https://assets.nintendo.com/image/upload/c_fill,w_1200/q_auto:best/f_auto/dpr_2.0/store/software/switch/70010000021207/88dfc4877546db18eeff30dfa891bf7ba1bbfd4544f4304341fbeafbb51c9330", url: "https://irv77.github.io/hd_fnaf/ps/" },
            'ucn': { title: "Ultimate Custom Night", desc: "Mashup ultime.", img: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRd_HDLIuYaC9mNbxnnZt7857CdseXa6-RZ3g&s", url: "https://irv77.github.io/hd_fnaf/ucn/" },
            
            // RETRO - DS
            'nsmb': { 
                title: "NEW SUPER MARIO BROS", 
                desc: "Le classique DS. (Fichier .nds)", 
                img: "https://upload.wikimedia.org/wikipedia/en/e/e0/New_Super_Mario_Bros._box_art.jpg", 
                romPath: "New Super Mario Bros.nds", 
                core: "nds"
            },

            // RETRO - N64
            'mario64': { 
                title: "SUPER MARIO 64", 
                desc: "La r√©volution 3D. (Fichier .z64)", 
                img: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQyQac_rGq8uZBzguFJ6kiOBVKs4iF1pDICkA&s", 
                romPath: "Super Mario 64 (Europe) (En,Fr,De).z64", 
                core: "n64"
            },

            // RETRO - NES
            'mario': { 
                title: "SUPER MARIO BROS", 
                desc: "Sauvez la princesse Peach.", 
                img: "https://upload.wikimedia.org/wikipedia/en/0/03/Super_Mario_Bros._box.png",
                romPath: "Super Mario Bros. (World).nes", 
                core: "nes"
            },

            // RETRO - GAME BOY
            'tetris': { 
                title: "TETRIS", 
                desc: "Le classique Game Boy.", 
                img: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQyhKxPYq5XDVZkYW7AJ7HkfMEHVCCG9xabOQ&s", 
                romPath: "Tetris (World) (Rev A).gb", 
                core: "gb" 
            },
            'flappy': { 
                title: "FLAPPY BIRD", 
                desc: "Un portage non-officiel addictif.", 
                img: "https://upload.wikimedia.org/wikipedia/en/0/0a/Flappy_Bird_icon.png", 
                romPath: "FlappyBird.gb", 
                core: "gb" 
            },
            'dk': { 
                title: "DONKEY KONG", 
                desc: "Le jeu Game Boy l√©gendaire.", 
                img: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSzZyml5vXLb2kPwK_aA2_ZuQvVoM_tqYv-Bw&s", 
                romPath: "Donkey Kong (World) (Rev A) (SGB Enhanced).gb", 
                core: "gb" 
            },
            'kirby': { 
                title: "KIRBY'S DREAM LAND", 
                desc: "La premi√®re aventure de Kirby.", 
                img: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRny7QVd-gXzZywEG3XIo1RZxagyBhSlS_TeA&s", 
                romPath: "Kirby's Dream Land (USA, Europe).gb", 
                core: "gb" 
            }
        };

        // --- GESTIONNAIRE DE FICHIER (CORRECTION CRITIQUE) ---
        document.getElementById('rom-uploader').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if(!file) return;
            
            const fileUrl = URL.createObjectURL(file); 
            const ext = file.name.split('.').pop().toLowerCase();
            
            // D√âTECTION INTELLIGENTE DU CORE
            let core = 'nes'; // par d√©faut
            
            if(ext === 'nds') core = 'nds';
            else if(ext === 'z64' || ext === 'n64') core = 'n64';
            else if(ext === 'gb') core = 'gb';
            else if(ext === 'gba') core = 'gba';
            else if(ext === 'smc' || ext === 'sfc') core = 'snes';
            else if(ext === 'md') core = 'segaMD';

            startEmulator(fileUrl, core); 
            this.value = null; 
        });

        // --- NAVIGATION ---
        function openCategory(cat) {
            document.getElementById('hubSection').style.display = 'none';
            document.getElementById('backBtn').style.display = 'block';
            document.body.classList.remove('theme-horror', 'theme-retro');
            document.querySelectorAll('.game-section').forEach(el => el.style.display = 'none');

            if(cat === 'horror') {
                document.body.classList.add('theme-horror');
                document.getElementById('horrorSection').style.display = 'flex';
                resetPreview('horror');
            } else if(cat === 'retro') {
                document.body.classList.add('theme-retro');
                document.getElementById('retroSection').style.display = 'flex';
                resetPreview('retro');
            }
        }

        function goBackToHub() {
            closeEmulator(false); 
            document.querySelectorAll('.game-section').forEach(el => el.style.display = 'none');
            document.getElementById('backBtn').style.display = 'none';
            document.getElementById('hubSection').style.display = 'flex';
            document.body.classList.remove('theme-horror', 'theme-retro');
        }

        // --- LANCEUR ---
        function launchGame(key) {
            const game = gamesData[key];
            if(!game) return;

            if (game.romPath) {
                // Tentative de lancement auto
                startEmulator(game.romPath, game.core);
            } else if (game.url) {
                window.location.href = game.url;
            }
        }

        // --- PREVIEWS ---
        function showPreview(gameKey, type) {
            if (window.matchMedia("(pointer: coarse)").matches) return; 

            const data = gamesData[gameKey];
            const staticEl = document.getElementById(type === 'horror' ? 'tvStaticHorror' : 'tvStaticRetro');
            const imgEl = document.getElementById(type === 'horror' ? 'previewImgHorror' : 'previewImgRetro');
            const titleEl = document.getElementById(type === 'horror' ? 'previewTitleHorror' : 'previewTitleRetro');
            const descEl = document.getElementById(type === 'horror' ? 'previewDescHorror' : 'previewDescRetro');

            if(data) {
                staticEl.style.display = 'none';
                imgEl.style.display = 'block';
                imgEl.src = data.img;
                titleEl.innerText = data.title;
                if (data.title.length > 15) titleEl.classList.add('long-text'); else titleEl.classList.remove('long-text');
                titleEl.style.color = type === 'horror' ? "#f1c40f" : "#00fff2"; 
                titleEl.classList.remove('blink-text'); 
                descEl.innerText = data.desc;
            }
        }

        function resetPreview(type) {
            if (window.matchMedia("(pointer: coarse)").matches) return; 

            const staticEl = document.getElementById(type === 'horror' ? 'tvStaticHorror' : 'tvStaticRetro');
            const imgEl = document.getElementById(type === 'horror' ? 'previewImgHorror' : 'previewImgRetro');
            const titleEl = document.getElementById(type === 'horror' ? 'previewTitleHorror' : 'previewTitleRetro');
            const descEl = document.getElementById(type === 'horror' ? 'previewDescHorror' : 'previewDescRetro');

            staticEl.style.display = 'block';
            imgEl.style.display = 'none';
            imgEl.src = ""; 
            titleEl.innerText = type === 'horror' ? "NO SIGNAL" : "INSERT COIN";
            titleEl.classList.remove('long-text');
            titleEl.style.color = ""; 
            titleEl.classList.add('blink-text'); 
            descEl.innerHTML = "... Connexion perdue ...<br>En attente d'entr√©e manuelle.";
        }

        // --- EMULATOR ENGINE ---
        function startEmulator(romUrl, core) {
            const emuScreen = document.getElementById('emulator-screen');
            const gameDiv = document.getElementById('game');
            
            // Si on est en local et que le chargement auto √©choue, on propose le manuel
            // Astuce : on utilise une variable pour d√©tecter si c'est un path ou une URL objet
            const isLocalPath = typeof romUrl === 'string' && !romUrl.startsWith('blob:');
            
            // Si c'est un chemin local et qu'on est en file://, on force l'upload manuel pour √©viter l'√©chec silencieux
            if (isLocalPath && window.location.protocol === 'file:') {
               alert("Mode local d√©tect√© : Veuillez s√©lectionner le fichier '" + romUrl + "' sur votre ordinateur pour jouer.");
               document.getElementById('rom-uploader').click();
               return;
            }

            gameDiv.innerHTML = '';
            emuScreen.style.display = 'flex';

            window.EJS_player = '#game';
            window.EJS_core = core; 
            window.EJS_gameUrl = romUrl; 
            window.EJS_pathtodata = 'https://cdn.emulatorjs.org/stable/data/'; 
            window.EJS_startOnLoaded = true;
            window.EJS_DEBUG_XX = false;

            const oldScript = document.getElementById('ejs-loader');
            if(oldScript) oldScript.remove();

            const script = document.createElement('script');
            script.src = 'https://cdn.emulatorjs.org/stable/data/loader.js';
            script.id = 'ejs-loader';
            document.body.appendChild(script);
        }

        function closeEmulator(forceReload = true) {
            if(forceReload && document.getElementById('emulator-screen').style.display === 'flex') {
                window.location.reload();
            } else {
                document.getElementById('emulator-screen').style.display = 'none';
                document.getElementById('game').innerHTML = ''; 
            }
        }

        window.onload = function() {
            document.getElementById('hubSection').style.display = 'flex';
            document.querySelectorAll('.game-section').forEach(el => el.style.display = 'none');
            document.getElementById('emulator-screen').style.display = 'none';
            document.getElementById('backBtn').style.display = 'none';
        };
    </script>
</body>
</html>
